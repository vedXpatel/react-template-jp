{"version":3,"file":"SliderTrack.js","sources":["../src/slider/internal/SliderTrack.tsx"],"sourcesContent":["import { makePrefixer } from \"@salt-ds/core\";\nimport {\n  type ComponentPropsWithoutRef,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\";\n\nimport type { ActiveThumbIndex, SliderValue, ThumbIndex } from \"../types\";\nimport { useSliderContext } from \"./SliderContext\";\nimport { SliderSelection } from \"./SliderSelection\";\nimport { SliderThumb } from \"./SliderThumb\";\nimport {\n  getNearestIndex,\n  getValue,\n  preventOverlappingValues,\n  setValue,\n} from \"./utils\";\n\nexport interface SliderTrackProps extends ComponentPropsWithoutRef<\"div\"> {}\n\nconst withBaseName = makePrefixer(\"saltSliderTrack\");\n\nexport const SliderTrack = ({ ...props }: SliderTrackProps) => {\n  const { min, max, step, value, onChange } = useSliderContext();\n\n  const trackRef = useRef<HTMLDivElement>(null);\n\n  const valueRef = useRef<SliderValue>(value);\n\n  const [activeThumb, setActiveThumbState] =\n    useState<ActiveThumbIndex>(undefined);\n  const activeThumbRef = useRef<ActiveThumbIndex>(undefined);\n  const pointerDown = useRef(false);\n\n  const setActiveThumb = (index: ActiveThumbIndex) => {\n    setActiveThumbState(index);\n    activeThumbRef.current = index;\n  };\n\n  const handlePointerUp = () => {\n    setActiveThumb(undefined);\n    pointerDown.current = false;\n  };\n\n  const handlePointerDown = (event: React.PointerEvent<HTMLDivElement>) => {\n    if (event.button !== 0) return;\n    const { clientX } = event;\n    const newValue: number = getValue(trackRef, min, max, step, clientX);\n    const nearestIndex = getNearestIndex(value, newValue);\n    setValue(value, newValue, value.length > 1 ? nearestIndex : 0, onChange);\n    setActiveThumb(nearestIndex);\n    pointerDown.current = true;\n  };\n\n  const handlePointerMove = (event: PointerEvent) => {\n    if (!pointerDown.current || typeof activeThumbRef.current === \"undefined\")\n      return;\n    const thumb = activeThumbRef.current;\n    const { clientX } = event;\n    const rawValue: number = getValue(trackRef, min, max, step, clientX);\n    const newValue = preventOverlappingValues(\n      valueRef.current,\n      rawValue,\n      thumb,\n    );\n    setValue(valueRef.current, newValue, thumb, onChange);\n  };\n\n  const handlePointerOut = () => {\n    if (!pointerDown.current) {\n      setActiveThumb(undefined);\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"pointerup\", handlePointerUp);\n    window.addEventListener(\"pointermove\", handlePointerMove);\n    return () => {\n      window.removeEventListener(\"pointerup\", handlePointerUp);\n      window.removeEventListener(\"pointermove\", handlePointerMove);\n    };\n  }, []);\n\n  useEffect(() => {\n    valueRef.current = value;\n  }, [value]);\n\n  return (\n    <div\n      className={withBaseName()}\n      ref={trackRef}\n      onPointerDown={handlePointerDown}\n      onPointerOut={handlePointerOut}\n      {...props}\n    >\n      <div className={withBaseName(\"rail\")} />\n      <SliderSelection />\n      {value.map((_, i) => {\n        return (\n          <SliderThumb\n            key={i}\n            index={i as ThumbIndex}\n            activeThumb={activeThumb}\n            setActiveThumb={setActiveThumb}\n          />\n        );\n      })}\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}